# steamtinkerlaunch

steamtinkerlaunch or short stl - is a linux wrapper bashscript for steam.
With its help every proton game creates/reads a config file with its own custom launch settings.

# features:

* define any env variable you want for every single game, f.e PROTON* , DXVK* variables, MANGOHUD, RADV_PERFTEST, WINE* and so on* custom program launch before or instead the game itself
* custom program launch before or instead the game itself (also windows exes in the same proton WINEPREFIX)
* winetricks before game launch
* winecfg before game launch
* gamemoderun
* notifier
* strace
* optionally start editor with game-specific config before game launch via keypress
* automatic reshade configuration for launched game (including optional Depth3D shader installation)

TODO:
* good feature requests

the idea is that you just have to edit the steam command line once (imho the editor is not very usable)
and everything else can be changed easily using stl

# installation: 
this is one single bash script. just copy it wherever you want, f.e. /usr/local/bin/

just call the script without any arguments
to initially create a default config template
"$HOME/.stl/default_template.conf"
and a default global config
"$HOME/.stl/global.conf"


you might want to change the default configs to your needs before use!

requirements:
--------------
the script itself doesn't have any special dependencies 

for the optional features you need:
- strace
- zenity (optional, $STEAM_ZENITY is used)
- gamemoderun
- mangohud
- winetricks
- wget, unzip for optional reshade download, git for pulling optional shaders

usage: add this program to your steam game command line like 'stl %command%'
-----------------------------------

stl will check if a config file exists in "$HOME/.stl/$SteamAppId.conf" for the game and will source it if available
if it is not available it is created from the default config file (which is automatically created if not found)

most options shipped with the (autowritten) default config are commented out.
described are only the variables which come from stl, for all others please check their upstream project:

global settings:

* JUSTWRITECFG=1 							# set to 1 to exit after writing the default config for the selected game without starting the game - useful for quickly creating a configuration
* CREATESTLDXVKCFGTMPL						# create an empty $STLDXVKCFG_tmpl for easier editing when required
* STRACEDIR=/tmp/ 							# the base strace path used to optionally dump strace logs
* STLLOG=/tmp/$(basename "$0").log			# the stl logfile
* WRITELOG=1								# write logfile if enabled
* STLEDITOR=geany							# the texteditor to use for opening the gameconfig - f.e. with WAITEDITOR
* WAITEDITOR=2								# wait WAITEDITOR seconds for a keypress to open the texteditor STLEDITOR with the game config; override via game config

if you do not want to start the editor requester on game launch just set WAITEDITOR=0 - it will be skipped then

#################

# loose function description:

custom game launch:
---------------------
when enabled you can also start custom programs easily with the following per-game config options:

set to 1 to enable the custom command CUSTOMCMD:
* RUN_CUSTOMCMD=1

start this custom command:
* CUSTOMCMD=yourProgram

start CUSTOMCMD command with following args:
* CUSTOMCMD_ARGS=--some --args

set to 1 to only start above CUSTOMCMD and not the game command itself:
* ONLY_CUSTOMCMD=0

set to 1 to fork the custom CUSTOMCMD into the background and continue with starting %command%
* FORK_CUSTOMCMD=1

winetricks:
------------
* RUN_WINETRICKS=1							# set to 1 to start winetricks gui before game launch

winecfg:
------------
* RUN_WINECFG=1								# set to 1 to start winecfg before game launch

gamemoderun:
-------------
* USEGAMEMODERUN=1							# set to 1 to start game with gamemoderun

notifier:
-----------
* NOTY=notify-send							# the notifier used

mangohud:
----------
* MANGOHUD=1								# set to 1 to enable mangohud - does nothing in stl itself, but just exports the upstream variable

radv aco:
----------
* #RADV_PERFTEST=aco						# aco is default starting with mesa 20.2 

strace:
----------
* STRACERUN=0 								# if set to 1 stl will write a strace log of the launched game
* STRACEOPTS=-f -t -e trace=file			# the strace options used for strace

when STRACERUN is enabled make sure
/proc/sys/kernel/yama/ptrace_scope is set to 0
else your user will get access denied when trying to attach a process
either "echo 0 > /proc/sys/kernel/yama/ptrace_scope" as root or enable it persistent in sysctl

reshade:
---------
* INSTALL_RESHADE=0							# set to 1 to automatically install reshade into the selected game dir.

the required reshade.conf is autogenerated on the first run with INSTALL_RESHADE enabled.
if DOWNLOAD_RESHADE in reshade.conf is set to 1 all required files for ReShade are downloaded once into RESHADESRCDIR
of course you can install all files manually as well. make sure to rename all files correctly:
64bit d3dcompiler_47.dll: -> d3dcompiler_47_64.dll
32bit d3dcompiler_47.dll: -> d3dcompiler_47_32.dll
ReShade64.dll,ReShade32.dll: renaming not required as they will be placed in the gamedir under the required name

the required architecture is autodetected from the game.exe and the matching files are copied from RESHADESRCDIR into the selected game dir
both downloadfiles and basic configuration were taken from (updated ReShade version)
https://www.reddit.com/r/linux_gaming/comments/b2hi3g/reshade_working_in_wine_43

* RESHADE_DEPTH3D=1		# set to 1 to install ReShade Depth3D Shader into gamedir
if CLONE_DEPTH3D is set to 1 the git repository will be automatically cloned/pulled (only when RESHADE_DEPTH3D=1)
with RESHADE_DEPTH3D enabled Overwatch.fxh, SuperDepth3D.fx, SuperDepth3D_VR.fx from Depth3D are copied to the gamedir.
when the game started just create a initial profile by selecting the autodetected SuperDepth3D_VR.fx
